DeviceProcessEvents
| where Timestamp > ago(7d)
| where FileName in~ ("certutil.exe", "mshta.exe", "rundll32.exe", "regsvr32.exe")
| where ProcessCommandLine has_any ("http", "https", ".dll", ".txt", "-urlcache", "-split")
| where InitiatingProcessFileName !in~ ("explorer.exe", "svchost.exe", "services.exe")
| where InitiatingProcessAccountName !endswith "$"
| project Timestamp, DeviceName, FileName, ProcessCommandLine, InitiatingProcessFileName, InitiatingProcessAccountName
